rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Regras para a coleção de licenças
    match /licenses/{document=**} {
      allow read: if true;
      // Admin cria e deleta
      allow create, delete: if request.auth != null;
      // Admin edita OU Cliente assina (envia contractAccepted=true)
      allow update: if request.auth != null || (request.resource.data.contractAccepted == true) || (resource.data.storeUrl == "" || resource.data.storeUrl == "*");
    }

    // Regras para a coleção de tickets
    match /tickets/{ticketId} {
      // Qualquer um cria, lê e atualiza (para responder mensagens)
      allow create: if true;
      allow read: if true;
      allow update: if true;
      
      // Apenas admin deleta
      allow delete: if request.auth != null;
    }
  }
}
